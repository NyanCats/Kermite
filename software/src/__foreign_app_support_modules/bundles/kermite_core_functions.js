(() => {
  // src/shared/defs/HidKeyCodes.ts
  var HidKey;
  (function(HidKey2) {
    HidKey2[HidKey2["KU_RESERVED"] = 0] = "KU_RESERVED";
    HidKey2[HidKey2["KU_A"] = 4] = "KU_A";
    HidKey2[HidKey2["KU_B"] = 5] = "KU_B";
    HidKey2[HidKey2["KU_C"] = 6] = "KU_C";
    HidKey2[HidKey2["KU_D"] = 7] = "KU_D";
    HidKey2[HidKey2["KU_E"] = 8] = "KU_E";
    HidKey2[HidKey2["KU_F"] = 9] = "KU_F";
    HidKey2[HidKey2["KU_G"] = 10] = "KU_G";
    HidKey2[HidKey2["KU_H"] = 11] = "KU_H";
    HidKey2[HidKey2["KU_I"] = 12] = "KU_I";
    HidKey2[HidKey2["KU_J"] = 13] = "KU_J";
    HidKey2[HidKey2["KU_K"] = 14] = "KU_K";
    HidKey2[HidKey2["KU_L"] = 15] = "KU_L";
    HidKey2[HidKey2["KU_M"] = 16] = "KU_M";
    HidKey2[HidKey2["KU_N"] = 17] = "KU_N";
    HidKey2[HidKey2["KU_O"] = 18] = "KU_O";
    HidKey2[HidKey2["KU_P"] = 19] = "KU_P";
    HidKey2[HidKey2["KU_Q"] = 20] = "KU_Q";
    HidKey2[HidKey2["KU_R"] = 21] = "KU_R";
    HidKey2[HidKey2["KU_S"] = 22] = "KU_S";
    HidKey2[HidKey2["KU_T"] = 23] = "KU_T";
    HidKey2[HidKey2["KU_U"] = 24] = "KU_U";
    HidKey2[HidKey2["KU_V"] = 25] = "KU_V";
    HidKey2[HidKey2["KU_W"] = 26] = "KU_W";
    HidKey2[HidKey2["KU_X"] = 27] = "KU_X";
    HidKey2[HidKey2["KU_Y"] = 28] = "KU_Y";
    HidKey2[HidKey2["KU_Z"] = 29] = "KU_Z";
    HidKey2[HidKey2["KU_Num1"] = 30] = "KU_Num1";
    HidKey2[HidKey2["KU_Num2"] = 31] = "KU_Num2";
    HidKey2[HidKey2["KU_Num3"] = 32] = "KU_Num3";
    HidKey2[HidKey2["KU_Num4"] = 33] = "KU_Num4";
    HidKey2[HidKey2["KU_Num5"] = 34] = "KU_Num5";
    HidKey2[HidKey2["KU_Num6"] = 35] = "KU_Num6";
    HidKey2[HidKey2["KU_Num7"] = 36] = "KU_Num7";
    HidKey2[HidKey2["KU_Num8"] = 37] = "KU_Num8";
    HidKey2[HidKey2["KU_Num9"] = 38] = "KU_Num9";
    HidKey2[HidKey2["KU_Num0"] = 39] = "KU_Num0";
    HidKey2[HidKey2["KU_Enter"] = 40] = "KU_Enter";
    HidKey2[HidKey2["KU_Escape"] = 41] = "KU_Escape";
    HidKey2[HidKey2["KU_BackSpace"] = 42] = "KU_BackSpace";
    HidKey2[HidKey2["KU_Tab"] = 43] = "KU_Tab";
    HidKey2[HidKey2["KU_Space"] = 44] = "KU_Space";
    HidKey2[HidKey2["KU_CapsLock"] = 57] = "KU_CapsLock";
    HidKey2[HidKey2["KU_F1"] = 58] = "KU_F1";
    HidKey2[HidKey2["KU_F2"] = 59] = "KU_F2";
    HidKey2[HidKey2["KU_F3"] = 60] = "KU_F3";
    HidKey2[HidKey2["KU_F4"] = 61] = "KU_F4";
    HidKey2[HidKey2["KU_F5"] = 62] = "KU_F5";
    HidKey2[HidKey2["KU_F6"] = 63] = "KU_F6";
    HidKey2[HidKey2["KU_F7"] = 64] = "KU_F7";
    HidKey2[HidKey2["KU_F8"] = 65] = "KU_F8";
    HidKey2[HidKey2["KU_F9"] = 66] = "KU_F9";
    HidKey2[HidKey2["KU_F10"] = 67] = "KU_F10";
    HidKey2[HidKey2["KU_F11"] = 68] = "KU_F11";
    HidKey2[HidKey2["KU_F12"] = 69] = "KU_F12";
    HidKey2[HidKey2["KU_PrintScreen"] = 70] = "KU_PrintScreen";
    HidKey2[HidKey2["KU_ScrollLock"] = 71] = "KU_ScrollLock";
    HidKey2[HidKey2["KU_Pause"] = 72] = "KU_Pause";
    HidKey2[HidKey2["KU_Insert"] = 73] = "KU_Insert";
    HidKey2[HidKey2["KU_Home"] = 74] = "KU_Home";
    HidKey2[HidKey2["KU_PageUp"] = 75] = "KU_PageUp";
    HidKey2[HidKey2["KU_Delete"] = 76] = "KU_Delete";
    HidKey2[HidKey2["KU_End"] = 77] = "KU_End";
    HidKey2[HidKey2["KU_PageDown"] = 78] = "KU_PageDown";
    HidKey2[HidKey2["KU_RightArrow"] = 79] = "KU_RightArrow";
    HidKey2[HidKey2["KU_LeftArrow"] = 80] = "KU_LeftArrow";
    HidKey2[HidKey2["KU_DownArrow"] = 81] = "KU_DownArrow";
    HidKey2[HidKey2["KU_UpArrow"] = 82] = "KU_UpArrow";
    HidKey2[HidKey2["KU_NumLock"] = 83] = "KU_NumLock";
    HidKey2[HidKey2["KU_KeyPad_Slash"] = 84] = "KU_KeyPad_Slash";
    HidKey2[HidKey2["KU_KeyPad_Asterisk"] = 85] = "KU_KeyPad_Asterisk";
    HidKey2[HidKey2["KU_KeyPad_Minus"] = 86] = "KU_KeyPad_Minus";
    HidKey2[HidKey2["KU_KeyPad_Plus"] = 87] = "KU_KeyPad_Plus";
    HidKey2[HidKey2["KU_KeyPad_Enter"] = 88] = "KU_KeyPad_Enter";
    HidKey2[HidKey2["KU_KeyPad_1"] = 89] = "KU_KeyPad_1";
    HidKey2[HidKey2["KU_KeyPad_2"] = 90] = "KU_KeyPad_2";
    HidKey2[HidKey2["KU_KeyPad_3"] = 91] = "KU_KeyPad_3";
    HidKey2[HidKey2["KU_KeyPad_4"] = 92] = "KU_KeyPad_4";
    HidKey2[HidKey2["KU_KeyPad_5"] = 93] = "KU_KeyPad_5";
    HidKey2[HidKey2["KU_KeyPad_6"] = 94] = "KU_KeyPad_6";
    HidKey2[HidKey2["KU_KeyPad_7"] = 95] = "KU_KeyPad_7";
    HidKey2[HidKey2["KU_KeyPad_8"] = 96] = "KU_KeyPad_8";
    HidKey2[HidKey2["KU_KeyPad_9"] = 97] = "KU_KeyPad_9";
    HidKey2[HidKey2["KU_KeyPad_0"] = 98] = "KU_KeyPad_0";
    HidKey2[HidKey2["KU_KeyPad_Dot"] = 99] = "KU_KeyPad_Dot";
    HidKey2[HidKey2["KU_KeyPad_Equal"] = 103] = "KU_KeyPad_Equal";
    HidKey2[HidKey2["KU_F13"] = 104] = "KU_F13";
    HidKey2[HidKey2["KU_F14"] = 105] = "KU_F14";
    HidKey2[HidKey2["KU_F15"] = 106] = "KU_F15";
    HidKey2[HidKey2["KU_F16"] = 107] = "KU_F16";
    HidKey2[HidKey2["KU_F17"] = 108] = "KU_F17";
    HidKey2[HidKey2["KU_F18"] = 109] = "KU_F18";
    HidKey2[HidKey2["KU_F19"] = 110] = "KU_F19";
    HidKey2[HidKey2["KU_F20"] = 111] = "KU_F20";
    HidKey2[HidKey2["KU_F21"] = 112] = "KU_F21";
    HidKey2[HidKey2["KU_F22"] = 113] = "KU_F22";
    HidKey2[HidKey2["KU_F23"] = 114] = "KU_F23";
    HidKey2[HidKey2["KU_F24"] = 115] = "KU_F24";
    HidKey2[HidKey2["KU_Menu"] = 118] = "KU_Menu";
    HidKey2[HidKey2["KU_KeyPad_00"] = 176] = "KU_KeyPad_00";
    HidKey2[HidKey2["KU_KeyPad_BackSpace"] = 187] = "KU_KeyPad_BackSpace";
    HidKey2[HidKey2["KU_LCtrl"] = 224] = "KU_LCtrl";
    HidKey2[HidKey2["KU_LShift"] = 225] = "KU_LShift";
    HidKey2[HidKey2["KU_LAlt"] = 226] = "KU_LAlt";
    HidKey2[HidKey2["KU_LGui"] = 227] = "KU_LGui";
    HidKey2[HidKey2["KU_RCtrl"] = 228] = "KU_RCtrl";
    HidKey2[HidKey2["KU_RShift"] = 229] = "KU_RShift";
    HidKey2[HidKey2["KU_RAlt"] = 230] = "KU_RAlt";
    HidKey2[HidKey2["KU_RGui"] = 231] = "KU_RGui";
    HidKey2[HidKey2["KU_Ctrl"] = 224] = "KU_Ctrl";
    HidKey2[HidKey2["KU_Shift"] = 225] = "KU_Shift";
    HidKey2[HidKey2["KU_Alt"] = 226] = "KU_Alt";
    HidKey2[HidKey2["KU_Gui"] = 227] = "KU_Gui";
  })(HidKey || (HidKey = {}));
  var HidKeyUS;
  (function(HidKeyUS2) {
    HidKeyUS2[HidKeyUS2["KU__US_Num1_Exclamation"] = 30] = "KU__US_Num1_Exclamation";
    HidKeyUS2[HidKeyUS2["KU__US_Num2_Atmark"] = 31] = "KU__US_Num2_Atmark";
    HidKeyUS2[HidKeyUS2["KU__US_Num3_Sharp"] = 32] = "KU__US_Num3_Sharp";
    HidKeyUS2[HidKeyUS2["KU__US_Num4_Dollars"] = 33] = "KU__US_Num4_Dollars";
    HidKeyUS2[HidKeyUS2["KU__US_Num5_Percent"] = 34] = "KU__US_Num5_Percent";
    HidKeyUS2[HidKeyUS2["KU__US_Num6_Circumflex"] = 35] = "KU__US_Num6_Circumflex";
    HidKeyUS2[HidKeyUS2["KU__US_Num7_Ampersand"] = 36] = "KU__US_Num7_Ampersand";
    HidKeyUS2[HidKeyUS2["KU__US_Num8_Asterisk"] = 37] = "KU__US_Num8_Asterisk";
    HidKeyUS2[HidKeyUS2["KU__US_Num9_LeftParenthesis"] = 38] = "KU__US_Num9_LeftParenthesis";
    HidKeyUS2[HidKeyUS2["KU__US_Num0_RightParenthesis"] = 39] = "KU__US_Num0_RightParenthesis";
    HidKeyUS2[HidKeyUS2["KU__US_Minus_Undersocre"] = 45] = "KU__US_Minus_Undersocre";
    HidKeyUS2[HidKeyUS2["KU__US_Equal_Plus"] = 46] = "KU__US_Equal_Plus";
    HidKeyUS2[HidKeyUS2["KU__US_LeftSquareBracket_LeftCurlyBrace"] = 47] = "KU__US_LeftSquareBracket_LeftCurlyBrace";
    HidKeyUS2[HidKeyUS2["KU__US_RightSquareBracket_RightCurlyBrace"] = 48] = "KU__US_RightSquareBracket_RightCurlyBrace";
    HidKeyUS2[HidKeyUS2["KU__US_Backslash_Verticalbar"] = 49] = "KU__US_Backslash_Verticalbar";
    HidKeyUS2[HidKeyUS2["KU__US_Sharp_Tilde"] = 50] = "KU__US_Sharp_Tilde";
    HidKeyUS2[HidKeyUS2["KU__US_Semicolon_Colon"] = 51] = "KU__US_Semicolon_Colon";
    HidKeyUS2[HidKeyUS2["KU__US_SingleQuote_DoubleQuote"] = 52] = "KU__US_SingleQuote_DoubleQuote";
    HidKeyUS2[HidKeyUS2["KU__US_BackQuote_Tilde"] = 53] = "KU__US_BackQuote_Tilde";
    HidKeyUS2[HidKeyUS2["KU__US_Comma_LessThan"] = 54] = "KU__US_Comma_LessThan";
    HidKeyUS2[HidKeyUS2["KU__US_Dot_GreaterThan"] = 55] = "KU__US_Dot_GreaterThan";
    HidKeyUS2[HidKeyUS2["KU__US_Slash_Question"] = 56] = "KU__US_Slash_Question";
  })(HidKeyUS || (HidKeyUS = {}));
  var HidKeyJP;
  (function(HidKeyJP2) {
    HidKeyJP2[HidKeyJP2["KU__JP_Num1_Exclamation"] = 30] = "KU__JP_Num1_Exclamation";
    HidKeyJP2[HidKeyJP2["KU__JP_Num2_DoubleQuote"] = 31] = "KU__JP_Num2_DoubleQuote";
    HidKeyJP2[HidKeyJP2["KU__JP_Num3_Sharp"] = 32] = "KU__JP_Num3_Sharp";
    HidKeyJP2[HidKeyJP2["KU__JP_Num4_Dollars"] = 33] = "KU__JP_Num4_Dollars";
    HidKeyJP2[HidKeyJP2["KU__JP_Num5_Percent"] = 34] = "KU__JP_Num5_Percent";
    HidKeyJP2[HidKeyJP2["KU__JP_Num6_Ampersand"] = 35] = "KU__JP_Num6_Ampersand";
    HidKeyJP2[HidKeyJP2["KU__JP_Num7_SingleQuote"] = 36] = "KU__JP_Num7_SingleQuote";
    HidKeyJP2[HidKeyJP2["KU__JP_Num8_LeftParenthesis"] = 37] = "KU__JP_Num8_LeftParenthesis";
    HidKeyJP2[HidKeyJP2["KU__JP_Num9_RightParenethesis"] = 38] = "KU__JP_Num9_RightParenethesis";
    HidKeyJP2[HidKeyJP2["KU__JP_Num0"] = 39] = "KU__JP_Num0";
    HidKeyJP2[HidKeyJP2["KU__JP_Minus_Equal"] = 45] = "KU__JP_Minus_Equal";
    HidKeyJP2[HidKeyJP2["KU__JP_Circumflex_Tilde"] = 46] = "KU__JP_Circumflex_Tilde";
    HidKeyJP2[HidKeyJP2["KU__JP_Atmark_BackQuote"] = 47] = "KU__JP_Atmark_BackQuote";
    HidKeyJP2[HidKeyJP2["KU__JP_LeftSquareBracket_LeftCurlyBrace"] = 48] = "KU__JP_LeftSquareBracket_LeftCurlyBrace";
    HidKeyJP2[HidKeyJP2["KU__JP_RightSquareBracket_RightCurlyBrace"] = 49] = "KU__JP_RightSquareBracket_RightCurlyBrace";
    HidKeyJP2[HidKeyJP2["KU__JP_Semicolon_Plus"] = 51] = "KU__JP_Semicolon_Plus";
    HidKeyJP2[HidKeyJP2["KU__JP_Colon_Asterisk"] = 52] = "KU__JP_Colon_Asterisk";
    HidKeyJP2[HidKeyJP2["KU_HankakuZenkaku"] = 53] = "KU_HankakuZenkaku";
    HidKeyJP2[HidKeyJP2["KU__JP_Comma_LessThan"] = 54] = "KU__JP_Comma_LessThan";
    HidKeyJP2[HidKeyJP2["KU__JP_Dot_GreaterThan"] = 55] = "KU__JP_Dot_GreaterThan";
    HidKeyJP2[HidKeyJP2["KU__JP_Slash_Question"] = 56] = "KU__JP_Slash_Question";
    HidKeyJP2[HidKeyJP2["KU__JP_BackSlash_Underscore"] = 135] = "KU__JP_BackSlash_Underscore";
    HidKeyJP2[HidKeyJP2["KU_KatakanaHiragana"] = 136] = "KU_KatakanaHiragana";
    HidKeyJP2[HidKeyJP2["KU__JP_Yen_VertiacalBar"] = 137] = "KU__JP_Yen_VertiacalBar";
    HidKeyJP2[HidKeyJP2["KU_Henkan"] = 138] = "KU_Henkan";
    HidKeyJP2[HidKeyJP2["KU_Muhenkan"] = 139] = "KU_Muhenkan";
  })(HidKeyJP || (HidKeyJP = {}));
  var OUT_SHIFT = 256;
  var OUT_NOSHIFT = 512;
  var virutalKeyToHidKeyMapper_Core = {
    K_A: 4,
    K_B: 5,
    K_C: 6,
    K_D: 7,
    K_E: 8,
    K_F: 9,
    K_G: 10,
    K_H: 11,
    K_I: 12,
    K_J: 13,
    K_K: 14,
    K_L: 15,
    K_M: 16,
    K_N: 17,
    K_O: 18,
    K_P: 19,
    K_Q: 20,
    K_R: 21,
    K_S: 22,
    K_T: 23,
    K_U: 24,
    K_V: 25,
    K_W: 26,
    K_X: 27,
    K_Y: 28,
    K_Z: 29,
    K_Num_0: 39 | OUT_NOSHIFT,
    K_Num_1: 30 | OUT_NOSHIFT,
    K_Num_2: 31 | OUT_NOSHIFT,
    K_Num_3: 32 | OUT_NOSHIFT,
    K_Num_4: 33 | OUT_NOSHIFT,
    K_Num_5: 34 | OUT_NOSHIFT,
    K_Num_6: 35 | OUT_NOSHIFT,
    K_Num_7: 36 | OUT_NOSHIFT,
    K_Num_8: 37 | OUT_NOSHIFT,
    K_Num_9: 38 | OUT_NOSHIFT,
    K_Escape: 41,
    K_Space: 44,
    K_Enter: 40,
    K_Tab: 43,
    K_BackSpace: 42,
    K_F1: 58,
    K_F2: 59,
    K_F3: 60,
    K_F4: 61,
    K_F5: 62,
    K_F6: 63,
    K_F7: 64,
    K_F8: 65,
    K_F9: 66,
    K_F10: 67,
    K_F11: 68,
    K_F12: 69,
    K_Shift: 225,
    K_Ctrl: 224,
    K_Alt: 226,
    K_OS: 227,
    K_LShift: 225,
    K_LCtrl: 224,
    K_LAlt: 226,
    K_LOS: 227,
    K_RShift: 229,
    K_RCtrl: 228,
    K_RAlt: 230,
    K_ROS: 231,
    K_Home: 74,
    K_End: 77,
    K_Insert: 73,
    K_Delete: 76,
    K_PageUp: 75,
    K_PageDn: 78,
    K_LeftArrow: 80,
    K_RightArrow: 79,
    K_UpArrow: 82,
    K_DownArrow: 81,
    K_HankakuZenkaku: 53,
    K_KatakanaHiragana: 136,
    K_Henkan: 138,
    K_Muhenkan: 139
  };
  var virutalKeyToHidKeyMapper_US = {
    K_Dot: 55 | OUT_NOSHIFT,
    K_Comma: 54 | OUT_NOSHIFT,
    K_Exclamation: 30 | OUT_SHIFT,
    K_Question: 56 | OUT_SHIFT,
    K_Colon: 51 | OUT_SHIFT,
    K_Semicolon: 51 | OUT_NOSHIFT,
    K_Underscore: 45 | OUT_SHIFT,
    K_Plus: 46 | OUT_SHIFT,
    K_Minus: 45 | OUT_NOSHIFT,
    K_Asterisk: 37 | OUT_SHIFT,
    K_Slash: 56 | OUT_NOSHIFT,
    K_Equal: 46 | OUT_NOSHIFT,
    K_Ampersand: 36 | OUT_SHIFT,
    K_VerticalBar: 49 | OUT_SHIFT,
    K_Hat: 35 | OUT_SHIFT,
    K_Tilde: 53 | OUT_SHIFT,
    K_AtMark: 31 | OUT_SHIFT,
    K_Sharp: 32 | OUT_SHIFT,
    K_Dollar: 33 | OUT_SHIFT,
    K_Yen: 49 | OUT_NOSHIFT,
    K_Percent: 34 | OUT_SHIFT,
    K_BackSlash: 49 | OUT_NOSHIFT,
    K_SingleQuote: 52 | OUT_NOSHIFT,
    K_DoubleQuote: 52 | OUT_SHIFT,
    K_BackQuote: 53 | OUT_NOSHIFT,
    K_LeftParenthesis: 38 | OUT_SHIFT,
    K_RightParenthesis: 39 | OUT_SHIFT,
    K_LeftSquareBracket: 47 | OUT_NOSHIFT,
    K_RightSquareBracket: 48 | OUT_NOSHIFT,
    K_LeftCurlyBrace: 47 | OUT_SHIFT,
    K_RightCurlyBrace: 48 | OUT_SHIFT,
    K_LessThan: 54 | OUT_SHIFT,
    K_GreaterThan: 55 | OUT_SHIFT
  };
  var virutalKeyToHidKeyMapper_JIS = {
    K_Dot: 55 | OUT_NOSHIFT,
    K_Comma: 54 | OUT_NOSHIFT,
    K_Exclamation: 30 | OUT_SHIFT,
    K_Question: 56 | OUT_SHIFT,
    K_Colon: 52 | OUT_NOSHIFT,
    K_Semicolon: 51 | OUT_NOSHIFT,
    K_Underscore: 135 | OUT_SHIFT,
    K_Plus: 51 | OUT_SHIFT,
    K_Minus: 45 | OUT_NOSHIFT,
    K_Asterisk: 52 | OUT_SHIFT,
    K_Slash: 56 | OUT_NOSHIFT,
    K_Equal: 45 | OUT_SHIFT,
    K_Ampersand: 35 | OUT_SHIFT,
    K_VerticalBar: 137 | OUT_SHIFT,
    K_Hat: 46 | OUT_NOSHIFT,
    K_Tilde: 46 | OUT_SHIFT,
    K_AtMark: 47 | OUT_NOSHIFT,
    K_Sharp: 32 | OUT_SHIFT,
    K_Dollar: 33 | OUT_SHIFT,
    K_Yen: 137 | OUT_NOSHIFT,
    K_Percent: 34 | OUT_SHIFT,
    K_BackSlash: 135 | OUT_NOSHIFT,
    K_SingleQuote: 36 | OUT_SHIFT,
    K_DoubleQuote: 31 | OUT_SHIFT,
    K_BackQuote: 47 | OUT_SHIFT,
    K_LeftParenthesis: 37 | OUT_SHIFT,
    K_RightParenthesis: 38 | OUT_SHIFT,
    K_LeftSquareBracket: 48 | OUT_NOSHIFT,
    K_RightSquareBracket: 49 | OUT_NOSHIFT,
    K_LeftCurlyBrace: 48 | OUT_SHIFT,
    K_RightCurlyBrace: 49 | OUT_SHIFT,
    K_LessThan: 54 | OUT_SHIFT,
    K_GreaterThan: 55 | OUT_SHIFT
  };

  // src/shared/defs/KeyboardDesign.ts
  function createFallbackPersistKeyboardDesign() {
    return {
      formatRevision: "LA00",
      setup: {
        placementUnit: "mm",
        placementAnchor: "center",
        keySizeUnit: "KP",
        keyIdMode: "auto"
      },
      keyEntities: [],
      outlineShapes: [],
      transformationGroups: []
    };
  }

  // src/shared/defs/ProfileData.ts
  var fallbackProfileData = {
    projectId: "",
    keyboardDesign: createFallbackPersistKeyboardDesign(),
    settings: {
      assignType: "single",
      useShiftCancel: false
    },
    layers: [
      {
        layerId: "la0",
        layerName: "main",
        defaultScheme: "block",
        exclusionGroup: 0,
        initialActive: true
      }
    ],
    assigns: {}
  };

  // src/shared/defs/VirtualKeyTexts.ts
  var VirtualKeyTexts = {
    K_NONE: "none",
    K_A: "A",
    K_B: "B",
    K_C: "C",
    K_D: "D",
    K_E: "E",
    K_F: "F",
    K_G: "G",
    K_H: "H",
    K_I: "I",
    K_J: "J",
    K_K: "K",
    K_L: "L",
    K_M: "M",
    K_N: "N",
    K_O: "O",
    K_P: "P",
    K_Q: "Q",
    K_R: "R",
    K_S: "S",
    K_T: "T",
    K_U: "U",
    K_V: "V",
    K_W: "W",
    K_X: "X",
    K_Y: "Y",
    K_Z: "Z",
    K_Num_1: "1",
    K_Num_2: "2",
    K_Num_3: "3",
    K_Num_4: "4",
    K_Num_5: "5",
    K_Num_6: "6",
    K_Num_7: "7",
    K_Num_8: "8",
    K_Num_9: "9",
    K_Num_0: "0",
    K_Enter: "enter",
    K_Escape: "esc",
    K_BackSpace: "bksp",
    K_Tab: "tab",
    K_Space: "space",
    K_HankakuZenkaku: "E/J",
    K_CapsLock: "cpslk",
    K_F1: "F1",
    K_F2: "F2",
    K_F3: "F3",
    K_F4: "F4",
    K_F5: "F5",
    K_F6: "F6",
    K_F7: "F7",
    K_F8: "F8",
    K_F9: "F9",
    K_F10: "F10",
    K_F11: "F11",
    K_F12: "F12",
    K_PrintScreen: "prtsc",
    K_Insert: "ins",
    K_Home: "home",
    K_PageUp: "pgup",
    K_Delete: "del",
    K_End: "end",
    K_PageDn: "pgdn",
    K_RightArrow: "\u2192",
    K_LeftArrow: "\u2190",
    K_DownArrow: "\u2193",
    K_UpArrow: "\u2191",
    K_KatakanaHiragana: "\u304B\u306A",
    K_Henkan: "\u5909\u63DB",
    K_Muhenkan: "\u7121\u5909",
    K_Exclamation: "!",
    K_AtMark: "@",
    K_Semicolon: ";",
    K_Colon: ":",
    K_Plus: "+",
    K_Asterisk: "*",
    K_Comma: ",",
    K_Dot: ".",
    K_Question: "?",
    K_Minus: "-",
    K_Underscore: "_",
    K_BackSlash: "\\",
    K_Yen: "\xA5",
    K_DoubleQuote: '"',
    K_Sharp: "#",
    K_Dollar: "$",
    K_Percent: "%",
    K_Ampersand: "&",
    K_SingleQuote: "'",
    K_LeftParenthesis: "(",
    K_RightParenthesis: ")",
    K_Equal: "=",
    K_Hat: "^",
    K_Tilde: "~",
    K_VerticalBar: "|",
    K_BackQuote: "`",
    K_LeftSquareBracket: "[",
    K_RightSquareBracket: "]",
    K_LeftCurlyBrace: "{",
    K_RightCurlyBrace: "}",
    K_LessThan: "<",
    K_GreaterThan: ">",
    K_Slash: "/",
    K_Ctrl: "ctrl",
    K_Shift: "shift",
    K_Alt: "alt",
    K_OS: "os",
    K_NN: "NN",
    K_LTU: "LTU",
    K_UU: "UU",
    K_NextDouble: "ND",
    K_PostDouble: "RP"
  };

  // src/shared/funcs/Utils.ts
  function flattenArray(arr) {
    const res = [];
    for (const ar of arr) {
      res.push(...ar);
    }
    return res;
  }
  function createDictionaryFromKeyValues(arr) {
    const obj = {};
    arr.forEach((el) => {
      const key = el[0];
      const value = el[1];
      obj[key] = value;
    });
    return obj;
  }
  function convertUndefinedToDefaultValue(value, defaultValue) {
    return value === void 0 ? defaultValue : value;
  }
  var degToRad = (deg) => deg * Math.PI / 180;
  function rotateCoord(p, theta) {
    const tmpX = p.x * Math.cos(theta) - p.y * Math.sin(theta);
    const tmpY = p.x * Math.sin(theta) + p.y * Math.cos(theta);
    p.x = tmpX;
    p.y = tmpY;
  }
  function translateCoord(p, ax, ay) {
    p.x += ax;
    p.y += ay;
  }

  // src/shared/modules/PlacementUnitHelper.ts
  function getCoordUnitFromUnitSpec(unitSpec) {
    if (unitSpec === "mm") {
      return {mode: "mm"};
    }
    const [p0, p1, p2] = unitSpec.split(" ");
    if (p0 === "KP") {
      const x = parseFloat(p1);
      const y = p2 !== void 0 ? parseFloat(p2) : x;
      return {mode: "KP", x, y};
    }
    throw new Error("invalid unit spec");
  }
  function getStdKeySize(shapeSpec, coordUnit, sizeUnit) {
    if (shapeSpec.startsWith("std")) {
      const [, p1, p2] = shapeSpec.split(" ");
      const pw = p1 && parseFloat(p1) || void 0;
      const ph = p2 && parseFloat(p2) || void 0;
      if (sizeUnit === "mm") {
        const w = pw || 10;
        const h = ph || pw || 10;
        return [w, h];
      } else if (sizeUnit === "KP") {
        const baseW = coordUnit.mode === "KP" && coordUnit.x || 19;
        const baseH = coordUnit.mode === "KP" && coordUnit.y || 19;
        const uw = pw || 1;
        const uh = ph || 1;
        return [uw * baseW - 1, uh * baseH - 1];
      }
    }
    return [18, 18];
  }
  function getKeySize(shapeSpec, coordUnit, keySizeUnit) {
    if (shapeSpec === "ext circle") {
      return [18, 18];
    } else if (shapeSpec === "ext isoEnter") {
      return [27, 37];
    }
    return getStdKeySize(shapeSpec, coordUnit, keySizeUnit);
  }

  // src/shared/modules/DisplayKeyboardDesignLoader.ts
  var DisplayKeyboardDesignLoader;
  (function(DisplayKeyboardDesignLoader2) {
    function transformOutlineShape(shape, isMirror, design) {
      const mi = isMirror ? -1 : 1;
      const groupIndex = convertUndefinedToDefaultValue(shape.groupIndex, -1);
      const {groupX, groupY, groupAngle} = getGroupTransAmount(design.transformationGroups[groupIndex]);
      const groupRot = degToRad(groupAngle);
      const points = shape.points.map((p0) => {
        const p = {x: p0.x * mi, y: p0.y};
        rotateCoord(p, groupRot * mi);
        translateCoord(p, groupX * mi, groupY);
        return p;
      });
      return {
        points
      };
    }
    function getGroupTransAmount(group) {
      const groupX = group?.x || 0;
      const groupY = group?.y || 0;
      const groupAngle = group?.angle || 0;
      return {groupX, groupY, groupAngle};
    }
    const isoEnterPathPoints = [
      [-16.125, -18.5],
      [-16.125, -0.5],
      [-11.375, -0.5],
      [-11.375, 18.5],
      [11.375, 18.5],
      [11.375, -18.5]
    ];
    function getKeyShape(shapeSpec, coordUnit, keySizeUnit) {
      if (shapeSpec === "ext circle") {
        return {type: "circle", radius: 9};
      } else if (shapeSpec === "ext isoEnter") {
        return {
          type: "polygon",
          points: isoEnterPathPoints.map(([x, y]) => ({x, y}))
        };
      }
      const [w, h] = getStdKeySize(shapeSpec, coordUnit, keySizeUnit);
      return {
        type: "rect",
        width: w,
        height: h
      };
    }
    function transformKeyEntity(ke, mke, coordUnit, design) {
      const isMirror = !!mke;
      const mi = isMirror ? -1 : 1;
      const keyX = coordUnit.mode === "KP" ? ke.x * coordUnit.x : ke.x;
      const keyY = coordUnit.mode === "KP" ? ke.y * coordUnit.y : ke.y;
      const keyAngle = convertUndefinedToDefaultValue(ke.angle, 0);
      const keyShape = convertUndefinedToDefaultValue(ke.shape, "std 1");
      const keyGroupIndex = convertUndefinedToDefaultValue(ke.groupIndex, -1);
      const {groupX, groupY, groupAngle} = getGroupTransAmount(design.transformationGroups[keyGroupIndex]);
      const groupRot = degToRad(groupAngle);
      const {keySizeUnit, placementAnchor} = design.setup;
      const [w, h] = getKeySize(keyShape, coordUnit, keySizeUnit);
      const p = {x: 0, y: 0};
      if (placementAnchor === "topLeft") {
        translateCoord(p, w / 2 + 0.5, h / 2 + 0.5);
      }
      translateCoord(p, keyX * mi, keyY);
      rotateCoord(p, groupRot * mi);
      translateCoord(p, groupX * mi, groupY);
      return {
        keyId: mke ? mke.keyId : ke.keyId,
        x: p.x,
        y: p.y,
        angle: (keyAngle + groupAngle) * mi,
        keyIndex: convertUndefinedToDefaultValue(mke ? mke.keyIndex : ke.keyIndex, -1),
        shapeSpec: keyShape,
        shape: getKeyShape(keyShape, coordUnit, keySizeUnit)
      };
    }
    function getBoundingBox(keyEntities, outlineShapes) {
      const xs = [];
      const ys = [];
      keyEntities.forEach((ke) => {
        const {shape} = ke;
        if (shape.type === "circle") {
          xs.push(ke.x - shape.radius);
          xs.push(ke.x + shape.radius);
          ys.push(ke.y - shape.radius);
          ys.push(ke.y + shape.radius);
        }
        if (shape.type === "rect") {
          const keyX = ke.x;
          const keyY = ke.y;
          const keyRot = degToRad(ke.angle);
          const hw = shape.width / 2;
          const hh = shape.height / 2;
          const points = [
            [-hw, -hh],
            [-hw, hh],
            [hw, -hh],
            [hw, hh]
          ];
          points.forEach(([px, py]) => {
            const p = {x: px, y: py};
            rotateCoord(p, keyRot);
            translateCoord(p, keyX, keyY);
            xs.push(p.x);
            ys.push(p.y);
          });
        }
        if (shape.type === "polygon") {
          const keyX = ke.x;
          const keyY = ke.y;
          const keyRot = degToRad(ke.angle);
          shape.points.forEach((p0) => {
            const p = {x: p0.x, y: p0.y};
            rotateCoord(p, keyRot);
            translateCoord(p, keyX, keyY);
            xs.push(p.x);
            ys.push(p.y);
          });
        }
      });
      outlineShapes.forEach((shape) => {
        shape.points.forEach((p) => {
          xs.push(p.x);
          ys.push(p.y);
        });
      });
      if (xs.length === 0 || ys.length === 0) {
        xs.push(-80);
        xs.push(80);
        ys.push(-60);
        ys.push(60);
      }
      const left = Math.min(...xs);
      const right = Math.max(...xs);
      const top = Math.min(...ys);
      const bottom = Math.max(...ys);
      return {
        centerX: (left + right) / 2,
        centerY: (top + bottom) / 2,
        width: right - left,
        height: bottom - top
      };
    }
    function getJoinedIfCenterEdgeSharedForMirrorShape(shape, group) {
      if (group.angle === 0 && group.x === 0) {
        const {points} = shape;
        const sharedEdgePointIndex = points.findIndex((point, idx) => {
          const nextPoint = points[(idx + 1) % points.length];
          return point.x === 0 && nextPoint.x === 0;
        });
        if (sharedEdgePointIndex !== -1) {
          const sortedPoints = points.map((_, idx) => points[(sharedEdgePointIndex + 1 + idx) % points.length]);
          const altSidePoints = sortedPoints.slice().reverse().slice(1, sortedPoints.length - 1).map((p) => ({x: -p.x, y: p.y}));
          const newPoints = [...sortedPoints, ...altSidePoints];
          return {
            groupIndex: shape.groupIndex,
            points: newPoints
          };
        }
      }
      return void 0;
    }
    function loadDisplayKeyboardDesign(design) {
      const coordUnit = getCoordUnitFromUnitSpec(design.setup.placementUnit);
      const keyEntities = flattenArray(design.keyEntities.map((ke) => {
        if ("mirrorOf" in ke) {
          return [];
        } else {
          const groupIndex = convertUndefinedToDefaultValue(ke.groupIndex, -1);
          const group = design.transformationGroups[groupIndex];
          if (group?.mirror) {
            const mke = design.keyEntities.find((k) => "mirrorOf" in k && k.mirrorOf === ke.keyId);
            return [
              transformKeyEntity(ke, void 0, coordUnit, design),
              transformKeyEntity(ke, mke, coordUnit, design)
            ];
          } else {
            return [transformKeyEntity(ke, void 0, coordUnit, design)];
          }
        }
      }));
      const outlineShapes = flattenArray(design.outlineShapes.map((shape) => {
        if (shape.points.length < 3) {
          return [];
        }
        const groupIndex = convertUndefinedToDefaultValue(shape.groupIndex, -1);
        const group = design.transformationGroups[groupIndex];
        if (group?.mirror) {
          const joinedShape = getJoinedIfCenterEdgeSharedForMirrorShape(shape, group);
          if (joinedShape) {
            return [transformOutlineShape(joinedShape, false, design)];
          }
          return [
            transformOutlineShape(shape, false, design),
            transformOutlineShape(shape, true, design)
          ];
        } else {
          return [transformOutlineShape(shape, false, design)];
        }
      }));
      const boundingBox = getBoundingBox(keyEntities, outlineShapes);
      return {
        keyEntities,
        outlineShapes,
        displayArea: boundingBox
      };
    }
    DisplayKeyboardDesignLoader2.loadDisplayKeyboardDesign = loadDisplayKeyboardDesign;
  })(DisplayKeyboardDesignLoader || (DisplayKeyboardDesignLoader = {}));

  // src/shell/loaders/ProfileDataConverter.ts
  var ProfileDataConverter;
  (function(ProfileDataConverter2) {
    function convertAssignsArrayToDictionary(assigns) {
      return createDictionaryFromKeyValues(assigns.map((assign) => {
        const {layerId, keyId, usage} = assign;
        const address = `${layerId}.${keyId}`;
        return [address, usage];
      }));
    }
    ProfileDataConverter2.convertAssignsArrayToDictionary = convertAssignsArrayToDictionary;
    function convertAssingsDictionaryToArray(assigns) {
      return Object.keys(assigns).map((address) => {
        const [layerId, keyId] = address.split(".");
        const usage = assigns[address];
        return {
          layerId,
          keyId,
          usage
        };
      });
    }
    ProfileDataConverter2.convertAssingsDictionaryToArray = convertAssingsDictionaryToArray;
    function convertProfileDataToPersist(source) {
      return {
        formatRevision: "PRF03",
        projectId: source.projectId,
        keyboardDesign: source.keyboardDesign,
        settings: source.settings,
        layers: source.layers,
        assigns: convertAssingsDictionaryToArray(source.assigns)
      };
    }
    ProfileDataConverter2.convertProfileDataToPersist = convertProfileDataToPersist;
    function convertProfileDataFromPersist(source) {
      return {
        projectId: source.projectId,
        keyboardDesign: source.keyboardDesign,
        settings: source.settings,
        layers: source.layers,
        assigns: convertAssignsArrayToDictionary(source.assigns)
      };
    }
    ProfileDataConverter2.convertProfileDataFromPersist = convertProfileDataFromPersist;
  })(ProfileDataConverter || (ProfileDataConverter = {}));

  // src/ui-common-svg/KeyUnitCardModels/KeyUnitCardViewModelCommon.ts
  function getAssignOperationText(op, layers) {
    if (op?.type === "keyInput") {
      const keyText = VirtualKeyTexts[op.virtualKey] || "";
      if (op.attachedModifiers) {
        const modText = op.attachedModifiers.map((m) => VirtualKeyTexts[m]?.charAt(0)).join("+");
        return `${modText}+${keyText}`;
      }
      return keyText;
    }
    if (op?.type === "layerClearExclusive") {
      return "ex-clear";
    }
    if (op?.type === "layerCall") {
      const layer = layers.find((la) => la.layerId === op.targetLayerId);
      if (layer && op.invocationMode === "turnOff") {
        return layer.layerName + "-off";
      }
      return layer?.layerName || "";
    }
    if (op?.type === "modifierCall") {
      return VirtualKeyTexts[op.modifierKey] || "";
    }
    return "";
  }
  function getAssignEntryTexts(assign, layers) {
    if (assign) {
      if (assign.type === "block" || assign.type === "layerFallbackBlock") {
        return {
          primaryText: "\u25A1",
          secondaryText: "",
          isLayerFallback: assign.type === "layerFallbackBlock"
        };
      }
      if (assign.type === "transparent" || assign.type === "layerFallbackTransparent") {
        return {
          primaryText: "\u21A1",
          secondaryText: "",
          isLayerFallback: assign.type === "layerFallbackTransparent"
        };
      }
      if (assign.type === "single") {
        return {
          primaryText: getAssignOperationText(assign.op, layers),
          secondaryText: "",
          isLayerFallback: false
        };
      }
      if (assign.type === "dual") {
        const prmText = getAssignOperationText(assign.primaryOp, layers);
        const secText = getAssignOperationText(assign.secondaryOp, layers);
        const terText = getAssignOperationText(assign.tertiaryOp, layers);
        if (assign.tertiaryOp) {
          return {
            primaryText: `${prmText} ${terText}`,
            secondaryText: secText,
            isLayerFallback: false
          };
        } else {
          return {
            primaryText: prmText,
            secondaryText: secText,
            isLayerFallback: false
          };
        }
      }
    }
    return {
      primaryText: "",
      secondaryText: "",
      isLayerFallback: false
    };
  }
  function getAssignForKeyUnitWithLayerFallback(keyUnitId, layerId, layers, assigns) {
    const assign = assigns[`${layerId}.${keyUnitId}`];
    if (!assign) {
      const layer = layers.find((la) => la.layerId === layerId);
      const defaultScheme = layer?.defaultScheme;
      if (defaultScheme === "transparent") {
        return {type: "layerFallbackTransparent"};
      }
      if (defaultScheme === "block") {
        return {type: "layerFallbackBlock"};
      }
    }
    return assign;
  }

  // src/__foreign_app_support_modules/kermite_core_functions.ts
  function createKeyUnitTextDisplayModel(ke, targetLayerId, layers, assigns) {
    const keyId = ke.keyId;
    const assign = getAssignForKeyUnitWithLayerFallback(keyId, targetLayerId, layers, assigns);
    const {primaryText, secondaryText, isLayerFallback} = getAssignEntryTexts(assign, layers);
    return {
      primaryText,
      secondaryText,
      isLayerFallback
    };
  }
  function createProfileLayersDisplayModel(persistProfileData) {
    const profileData = ProfileDataConverter.convertProfileDataFromPersist(persistProfileData);
    const keyboardDesign = DisplayKeyboardDesignLoader.loadDisplayKeyboardDesign(profileData.keyboardDesign);
    const keyUnits = keyboardDesign.keyEntities.map((ke) => ({
      keyId: ke.keyId,
      x: ke.x,
      y: ke.y,
      angle: ke.angle || 0,
      shape: ke.shape
    }));
    const {layers, assigns} = profileData;
    const layerKeyUnitTexts = createDictionaryFromKeyValues(layers.map((la) => {
      const keyUnitTextDisplayModelsDict = createDictionaryFromKeyValues(keyboardDesign.keyEntities.map((ke) => {
        const textDispalyModel = createKeyUnitTextDisplayModel(ke, la.layerId, layers, assigns);
        return [ke.keyId, textDispalyModel];
      }));
      return [la.layerId, keyUnitTextDisplayModelsDict];
    }));
    const completeKeyUnitTexts = layerKeyUnitTexts.la0;
    return {
      displayArea: keyboardDesign.displayArea,
      outlineShapes: keyboardDesign.outlineShapes,
      keyUnits,
      layerKeyUnitTexts,
      completeKeyUnitTexts
    };
  }
  window.KermiteCoreFunctions = {
    createProfileLayersDisplayModel
  };
})();
